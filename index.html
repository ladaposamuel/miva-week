<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>What week are we in?</title>
  <meta name="description" content="Semester started on September 2, 2024. Check current week.">
  <meta property="og:title" content="What week are we in?">
  <meta property="og:description" content="Semester started on September 2, 2024. Check current week.">
  <meta property="og:image" content="https://miva.vercel.app/week-preview.jpg">
  <meta property="og:url" content="https://miva.vercel.app">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="What week are we in?">
  <meta name="twitter:description" content="Semester started on September 2, 2024. Check current week.">
  <meta name="twitter:image" content="https://miva.vercel.app/week-preview.jpg">

  <link id="favicon" rel="icon" type="image/png"
    href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAACQkWg2AAAAQElEQVQoz2P4jwQWLVr0HwOgCbKcZWRkgINFi1C42AQZzzCQBlgOkqiB8dmzZyRpYCLRglENQ1UDy969e0nSAAAH9Dkwdj7YwgAAAABJRU5ErkJggg==" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #0A3150;
      color: #ffffff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }

    #container {
      background-color: rgba(255, 255, 255, 0.1);
      border: 2px solid #E83831;
      border-radius: 10px;
      padding: 30px;
      text-align: center;
    }

    .current-week {
      font-size: 4.5em;
      font-weight: bold;
      margin-bottom: 20px;
      color: #E83831;
    }

    .countdown,
    .current-datetime {
      font-size: 1.2em;
      margin-bottom: 15px;
      color: #ffffff;
    }
  </style>
</head>

<body>
  <div id="container">
    <b>Current week:</b>
    <div class="current-week" id="currentWeek"></div>
    <div class="countdown" id="countdown"></div>
    <hr />
    <b>Today is:</b>
    <p></p>
    <div class="current-datetime" id="currentDateTime"></div>
  </div>
  <script>
    // Goal: Restructure code to only use javascript and also avoid side effects (https://en.wikipedia.org/wiki/Side_effect_(computer_science)) by using encapsulation;

    const semesterStart = new Date( '2024-09-02' );
    const examDate = new Date( '2024-12-02' );
    // Your function second arg is "w", that's not descriptive enough.
    const favicon = ( link, week ) => {
      // 1. Define favicon
      // Point to note: This ðŸ‘‡ was only used within this enclosing function (favicon), there is no need to define it outside of it.
      const faviconURL = document.getElementById( 'favicon' ).href;

      const canvas = document.createElement( 'canvas' );
      canvas.width = 16;
      canvas.height = 16;

      const ctx = canvas.getContext( '2d' );
      const img = new Image();

      img.onload = () => {
        ctx.drawImage( img, 0, 0 );

        ctx.fillStyle = 'black';
        ctx.font = 'bold 10px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText( week, 8, 13 );

        let url = canvas.toDataURL( 'image/png' );
        link.setAttribute( 'src', url );
        link.setAttribute( 'href', url );
      };

      img.src = faviconURL;
    };

    function updateFavicon( weekNumber ) {
      const link = document.getElementById( 'favicon' );
      let week = weekNumber;
      if ( week < 1 || week > 14 ) week = 'âˆž';

      favicon( link, week );
    }

    function updateMetaTags( weekNumber ) {
      const now = new Date();
      const timeToExam = examDate - now;
      const daysToExam = Math.floor( timeToExam / ( 24 * 60 * 60 * 1000 ) );

      const description = `Currently in Week ${weekNumber}. ${daysToExam} days until the exam on ${ examDate.toDateString() }.`;
      const title = `Week ${ weekNumber } - What week are we in?`;

      // Update description
      document.querySelector( 'meta[name="description"]' ).textContent = description;
      document.querySelector( 'meta[property="og:description"]' ).textContent = description;

      // Point to note: You don't need to set twitter:description since it is the same as description and og-description
      // document.querySelector( 'meta[name="twitter:description"]' ).textContent = description;

      // Update
      document.querySelector( 'title' ).textContent = title;
      document.querySelector( 'meta[property="og:title"]' ).textContent = title;

      // Point to note: You don't need to set twitter:title since it is the same as description and og-description
      // document.querySelector( 'meta[name="twitter:title"]' ).textContent = title;

      // More point to note: Google does not care about seo keywords anymore
    }

    function updateDisplay() {
      // Set the start date of the semester and the exam date
      // The above has been moved inside updateDisplay as it can cause a side effect outside of it. Also, it was only used within updateDisplay

      const now = new Date();

      // Calculate current week of the semester
      const weeksPassed = Math.floor( ( now - semesterStart) / ( 7 * 24 * 60 * 60 * 1000 ) ) + 1;
      document.getElementById( 'currentWeek' ).textContent = `Week ${ weeksPassed }`;

      // Calculate countdown to exam
      const timeToExam = examDate - now;
      const daysToExam = Math.floor( timeToExam / ( 24 * 60 * 60 * 1000 ) );
      const hoursToExam = Math.floor( ( timeToExam % ( 24 * 60 * 60 * 1000 ) ) / ( 60 * 60 * 1000 ) );

      document.getElementById( 'countdown' ).textContent = `${ daysToExam } days ${ hoursToExam } hours to exam`;

      // Update current date and time
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' };

      document.getElementById( 'currentDateTime' ).textContent = now.toLocaleDateString( 'en-US', options );

      const week = Math.ceil( ( now - semesterStart) / ( 1000 * 60 * 60 * 24 * 7 ) );

      updateFavicon( week );
      updateMetaTags( week );
    }

    // I don't know what this is for, but here is a rewrite in plain js
    const pad = () => {
      const unixTime = new Date().getTime();
      const newImage = new Image();
      newImage.src = `weeklee.gif?now=' + ${ unixTime }`;

      return newImage;
    };

    // Initialization should only happen/start when all the DOM content is loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Well...
      setInterval( updateDisplay, 1000 );
    });
  </script>
</body>

</html>